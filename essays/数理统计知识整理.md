[<font size=4>←返回主目录<font>](./README.md)
</br></br></br>

## 1 线性回归

### 1.1 原理分析

要研究最大积雪深度x与灌溉面积y之间的关系，测试得到近10年的数据如下表：

![][最大积雪深度-灌溉面积]

使用线性回归的方法可以估计x与y之间的线性关系。

线性回归方程式：

![][回归方程]

对应的估计方程式为

![][线性回归方程]

线性回归完成的任务是，依据观测数据集(x1,y1),(x2,y2),...,(xn,yn)使用线性拟合估计回归方程中的参数a和b。a,b都为估计结果，原方程中的真实值一般用α和β表示。

为什么要做这种拟合呢？

答案是：为了预测。比如根据前期的股票数据拟合得到股票的变化趋势（当然股票的变化可就不是这么简单的线性关系了）。

线性回归的拟合过程使用最小二乘法，

![][最小二乘法]

最小二乘法的原理是：选择a,b的值，使得残差的平方和最小。

为什么是平方和最小，不是绝对值的和？答案是，绝对值也可以，但是，绝对值进行代数运算没有平方那样的方便，4次方又显得太复杂，数学中这种“转化化归”的思路表现得是那么的优美！

残差平方和Q，

![][残差]

求最小，方法有很多。代数方法是求导，还有一些运筹学优化的方法（梯度下降、牛顿法），这里只需要使用求导就OK了，

![][残差和求导]

为表示方便，引入一些符号，

![][线性回归符号]

最终估计参数a与b的结果是：

![][b]

![][a]

自此，针对前面的例子，只要将观测数据带入上面表达式即可计算得到拟合之后的a和b。不妨试一试？


从线性函数的角度，b表示的拟合直线的斜率，不考虑数学的严谨性，从应用的角度，结果的b可以看成是离散点的斜率，表示变化趋势，b的绝对值越大，表示数据的变化越快。

线性回归的估计方法存在误差，误差的大小通过Q衡量。


### 1.2 误差分析

考虑获取观测数据的实验中存在其它的影响因素，将这些因素全部考虑到e~N(0,δ^2)中，回归方程重写为

y = a + bx + e

由此计算估计量a与b的方差结果为，

![][Dab]

a与b的方差不仅与δ和x的波动大小有关，而且还与观察数据的个数有关。在设计观测实验时，x的取值越分散，估计ab的误差就越小，数据量越大，估计量b的效果越好。这也许能为设计实验搜集数据提供某些指导。


### 1.3 拟合优度检验及统计量

拟合优度检验模型对样本观测值的拟合程度，其方法是构造一个可以表征拟合程度的指标，称为统计量，统计量是样本的函数。从检验对象中计算出该统计量的数值，然后与某一标准进行比较，得出检验结论。

这是又会问了，最小二乘法不是保证了模型最好的拟合样本观测值了吗？为什么还要检验拟合程度？

最小二乘法保证的是同一个样本集使用最小二乘法拟合程度最好，而拟合优度检验结果表示的是多个不同样本集各自进行拟合后对拟合效果的比较。比如，下面的直线方程都是使用最小二乘法拟合的结果，但二者对样本观测值的拟合程度显然不同。

![][拟合优度检验]


为构造统计量，先定义三个表达式：


![][Se]

![][SR]

![][ST]

通过推倒可以发现：![][ST-Se-SR]

![][_ST]表示观测值y1,y2,y3,...yn与它们的平均值的离差平方和，![][_ST]越大，则观测值的波动越大。因此称总离差平方和。

![][_SR]表示回归直线上点的纵坐标^y1,^y2,...,^yn与与观测值均值的离差平方和。所以称为回归平方和。![][_SR]反映出回归直线因素对![][_ST]的影响。

![][_Se]是最小二乘法中残差平方和Q的最小值，它是实际观测值yi与回归直线上的点(xi,^yi)的纵坐标^yi的离差平方和。![][_Se]是扣除线性影响外的剩余平方和，因此称为残差平方和。

显然，一个拟合得比较好的模型，![][_ST]与![][_SR]应该比较接近，而![][_Se]应该尽可能的小。因此，可以通过构造某种![][_ST]与![][_SR]的表达式作为拟合优度检验中的统计量。

- 构造统计量――相关系数

因此，构造相关系数

![][相关系数]

不同的r值有不同的线性相关表示，如下图

![][相关系数图]

结论：

	当|r|->0时，表示x与y之间的线性关系不明显，不适合使用线性回归建模。反之，当|r|越接近1时，表示x与y之间的线性关系越密切。


- 构造统计量――F

![][统计量F]

F值越小表示线性关系越密切，反之线性关系越弱。

- 构造统计量――t

![][统计量t]

|t|越大，x与y之间的线性关系越密切；反之，越小，x与y之间的线性关系越微弱。


不管是相关系数，还是F，或者t，都能用于描述x与y之间的线性相关程度。并且可以通过验证，这三种统计量用于下面的显著性检验是完全一致的。

### 1.4 显著性检验

显著性检验，

以开头“最大积雪深度x与灌溉面积y之间的关系”的线性关系是否显著为例，使用上面构造的统计量进行显著性检验的过程如下：

![][显著性检验-1]

![][显著性检验-2]

![][显著性检验-3]

![][显著性检验-4]

![][显著性检验-5]

在当中，计算线性回归及显著性检验使用到如下的公式，下面的公式不用记住，使用时查询即可。


![][线性回归季显著性检验的公式]

相关系数的查表参见[相关系数显著性检验表]


### 1.5 置信区间

回归系数α以1-α为置信度的置信区间为

![][alpha置信区间]

回归系数β以1-α为置信度的置信区间为

![][beta置信区间]

其中S都为，

![][S-Equal]


### 1.6 回归分析的实际操作步骤

回归分析的主要内容是通过试验或观测数据，寻找相关变量之间的统计规律性，再利用自变量的值有效预测因变量的可能取值。

其实际操作的步骤是：

1. 设定回归方程
2. 根据误差分析，考虑搜集数据对回归方程参数的影响，有目的的搜集数据
3. 确定回归系数
4. 进行相关性检验
5. 预测


## 2 方差分析

### 2.1 引入

![][灯泡寿命-灯丝]

如上图，对A1~A4共4种不同灯丝的灯泡进行抽样检测灯泡寿命，根据测试数据，现在要问：灯泡寿命是否与灯丝材料的不同有关。

问题特点有：

- 1项指标（__因变量__）：寿命
- 影响指标的因素（__因子__）：灯丝
- 因素存在多个不同状态（__水平__），要求分析因素的不同状态是否对指标有显著影响

这就是方差分析问题：用数理统计分析试验结果、鉴别各因素对结果影响程度的方法称为方差分析（Analysis Of Variance），记作ANOVA。

### 2.2 单因素方差分析

其它因素不变，只考虑一个因素A，因素存在多个水平，在每个水平上做若干次实验，从实验结果推断是否该因素对指标有显著影响？这就是单因素的方差分析，上面的例子就是单因素方差分析的例子。

- 前提假设

设因素A的r个水平为A1,A1,...,Ar，每个水平下的指标服从正态分布N(u1,δ2),N(u2,δ2),...,N(ur,δ2)。

- 模型建立

实验数据的格式：

![][单因素方差分析实验数据表]

因子对指标是否有影响取决于指标的正态分布是否一致，如果有影响，则正态分布应该存在差异，而正态分布由均值和方差决定，假设中方差相同，因此各个水平下的正态分布均值直接决定因素是否对指标有影响。

所以，问题可以转化为假设检验，设

H0: u1=u2=u3=...=ur

检验结果如果拒绝原假设，则认为因素A对指标有显著影响，否则认为无显著影响。

设

u = (1/r)\sum_1^a{ui}

αi = ui - u

则，H0假设改写成

H0: α1=α2=α3=...=αr=0

- 构造统计量（摘自《数学建模Matlab大全》）

![][方差分析1]
![][方差分析2]

- 单因素方差分析表

过对上面模型中相关参数进行计算，为计算分析方便，将结果填入下表中：

![][单因素方差分析表]

表中的Pr反映的就是>F值的概率，F值通过因素A均方除以误差均方获得。

因此，有

1. 如果Pr大于α，则接受H0，因素对指标无显著影响
2. 如果Pr小于α，则拒绝H0，因素对指标有显著影响

Matlab的输出结果即为上面的方差分析表，因此，用matlab很容易进行方差分析。

### 2.3 用Matlab进行单因素方差分析

![][单因素方差分析题]

能否认为这三所小学五年级男学生的平均身高相同？取显著水平α=0.05.

假设H0: 这三所小学五年级男学生的平均身高相同。

```Matlab
data = [...
128.1	134.1	131.1	138.9	140.8	127.4; ...
150.3	147.9	136.8	126.0	150.7	155.8; ...
140.6	143.1	144.5	143.7	148.5	146.4...
];
data = data';

P=anova1(data);  % 方差分析函数anova1
```

Matlab程序的运行结果为：

![][单因素方差分析Matlab]

∵ Pr=0.0275 < α
∴ 拒绝H0，即不能认为这三所小学五年级男学生的平均身高相同。

实验数据也可以是非平衡数据，如上，假设小学2的测试数据少一组：

![][单因素方差分析题1]

此时，anova1调用格式有所改变，

```
p=anova1(x,group) 

% x 为向量，从第 1 组到第r组数据依次排列；group 为与 x 同长度的向量，标志 x 中数
% 据的组别（在与 x 第i组数据相对应的位置处输入整数 i=1,2,..r）
```

此时的Matlab代码为：

```matlab
x = [...
128.1	134.1	131.1	138.9	140.8	127.4; ...
150.3	147.9	136.8	126.0	150.7	0; ...
140.6	143.1	144.5	143.7	148.5	146.4...
];
x = [x(1,:),x(2,1:5),x(3,:)];
g = [ones(1,6),2*ones(1,5),3*ones(1,6)];
    
P=anova1(x, g);
```

结果为

![][单因素方差分析Matlab1]

因为仅改变了一个实验数据，其结果和前面的一致。



## 3 回归分析与方差分析的比较




## 参考

1. [相关系数显著性检验表]
2. 北京科技大学统计优化研究生课程课件
3. 数学建模Matlab大全（共30章）
4.  







[最大积雪深度-灌溉面积]:../images/数理统计知识整理/最大积雪深度-灌溉面积.png
[回归方程]:../images/数理统计知识整理/回归方程.png
[线性回归方程]:../images/数理统计知识整理/线性回归方程.png
[最小二乘法]:../images/数理统计知识整理/最小二乘法.png
[残差]:../images/数理统计知识整理/残差.png
[残差和求导]:../images/数理统计知识整理/残差和求导.png
[线性回归符号]:../images/数理统计知识整理/线性回归符号.png
[Dab]:../images/数理统计知识整理/Dab.png
[拟合优度检验]:../images/数理统计知识整理/拟合优度检验.png
[Se]:../images/数理统计知识整理/Se.gif
[SR]:../images/数理统计知识整理/SR.gif
[ST]:../images/数理统计知识整理/ST.gif
[_Se]:../images/数理统计知识整理/_Se.gif
[_SR]:../images/数理统计知识整理/_SR.gif
[_ST]:../images/数理统计知识整理/_ST.gif
[ST-Se-SR]:../images/数理统计知识整理/ST_Se_SR.gif
[相关系数]:../images/数理统计知识整理/相关系数.png
[相关系数图]:../images/数理统计知识整理/相关系数图.png
[统计量F]:../images/数理统计知识整理/统计量F.png
[统计量t]:../images/数理统计知识整理/统计量t.png
[显著性检验-1]:../images/数理统计知识整理/显著性检验-1.png
[显著性检验-2]:../images/数理统计知识整理/显著性检验-2.png
[显著性检验-3]:../images/数理统计知识整理/显著性检验-3.png
[显著性检验-4]:../images/数理统计知识整理/显著性检验-4.png
[显著性检验-5]:../images/数理统计知识整理/显著性检验-5.png
[线性回归季显著性检验的公式]:../images/数理统计知识整理/线性回归季显著性检验的公式.png
[alpha置信区间]:../images/数理统计知识整理/alpha置信区间.png
[beta置信区间]:../images/数理统计知识整理/beta置信区间.png
[S-Equal]:../images/数理统计知识整理/S_Equal.png

[方差分析表]:../images/数理统计知识整理/方差分析表.png

[灯泡寿命-灯丝]:../images/数理统计知识整理/灯泡寿命-灯丝.png
[方差分析1]:../images/数理统计知识整理/方差分析1.png
[方差分析2]:../images/数理统计知识整理/方差分析2.png
[单因素方差分析实验数据表]:../images/数理统计知识整理/单因素方差分析实验数据表.png
[单因素方差分析表]:../images/数理统计知识整理/单因素方差分析表.png
[单因素方差分析题]:../images/数理统计知识整理/单因素方差分析题.png
[单因素方差分析题1]:../images/数理统计知识整理/单因素方差分析题1.png
[单因素方差分析Matlab]:../images/数理统计知识整理//单因素方差分析Matlab.png
[单因素方差分析Matlab1]:../images/数理统计知识整理//单因素方差分析Matlab1.png



[相关系数显著性检验表]:../enclosure/数理统计知识整理/相关系数显着性检验表(完整润色版).xls



