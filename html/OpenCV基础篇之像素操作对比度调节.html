<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"><link rel="stylesheet" id="theme" href="../stylesheets/Github.css"></head><body><p><a href="../README.html"><font size="4">←返回主目录<font></font></font></a><font size="4"><font>
<br><br><br></font></font></p><font size="4"><font>
<h2>程序及分析</h2>
<pre><code class="language-c cpp"><span class="comment">/*
 * FileName : contrast.cpp
 * Author   : xiahouzuoxin @163.com
 * Version  : v1.0
 * Date     : Tue 29 Jul 2014 08:09:57 PM CST
 * Brief    : 
 * 
 * Copyright (C) MICL,USTB
 */</span>
<span class="preprocessor">#include &lt;cv.h&gt;</span>
<span class="preprocessor">#include &lt;highgui.h&gt;</span>
<span class="preprocessor">#include &lt;iostream&gt;</span>


<span class="keyword">using</span> <span class="keyword">namespace</span> cv;
<span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;

<span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])
{
    <span class="keyword">float</span> alpha = <span class="number">0</span>;
    <span class="keyword">int</span>   beta  = <span class="number">0</span>;
    Mat   image;
    Mat   result;

    <span class="keyword">if</span> (argc&lt;<span class="number">2</span>) {
        <span class="built_in">cout</span>&lt;&lt;<span class="string">"Usage:./contrast [image_name]"</span>&lt;&lt;endl;
        <span class="keyword">return</span> -<span class="number">1</span>;
    }

    image = imread(argv[<span class="number">1</span>]);
    <span class="keyword">if</span> (!image.data) {
        <span class="built_in">cout</span>&lt;&lt;<span class="string">"Read image error."</span>&lt;&lt;endl;
    }

    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Enter alpha value[1-3]:"</span>&lt;&lt;endl;
    <span class="built_in">cin</span>&gt;&gt;alpha;
    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Enter beta value[0-100]:"</span>&lt;&lt;endl;
    <span class="built_in">cin</span>&gt;&gt;beta;    

    result.create(image.size(), image.type()); 

    <span class="keyword">int</span> n = image.rows * image.cols * image.channels();
    uchar *p = image.data;
    uchar *q = result.data;
    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++) {
        *q++ = saturate_cast&lt;uchar&gt;(alpha * (*p++) + beta);     
    }

    namedWindow(<span class="string">"origin"</span>, CV_WINDOW_AUTOSIZE);
    imshow(<span class="string">"origin"</span>, image);
    namedWindow(<span class="string">"result"</span>, CV_WINDOW_AUTOSIZE);
    imshow(<span class="string">"result"</span>, result);

    waitKey(<span class="number">0</span>);

    <span class="keyword">return</span> <span class="number">0</span>;
}</code></pre>
<ol>
<li>用到Mat::create成员方法用于对Mat对象的数据赋值</li>
<li><p>saturate_cast在operations.hpp中定义和声明，这里的传人参数为float类型，调用的是</p>
<pre><code class="xml">template<span class="tag">&lt;&gt;</span> inline uchar saturate_cast<span class="tag">&lt;<span class="title">uchar</span>&gt;</span>(float v)
{int iv = cvRound(v); return saturate_cast<span class="tag">&lt;<span class="title">uchar</span>&gt;</span>(iv);}</code></pre>
<p>其中调用重载函数saturate_cast<uchar>(int)完成，该函数的实现是：</uchar></p>
<pre><code class="xml">template<span class="tag">&lt;&gt;</span> inline uchar saturate_cast<span class="tag">&lt;<span class="title">uchar</span>&gt;</span>(int v)
{return (uchar)((unsigned)v <span class="tag">&lt;<span class="title">=</span> <span class="attribute">UCHAR_MAX</span> ? <span class="attribute">v</span> <span class="attribute">:</span> <span class="attribute">v</span> &gt;</span> 0 ? UCHAR_MAX : 0)}</code></pre>
<p>由于?:运算符是右结合特性，saturate_cast函数的作用就是：限制数据范围为0~255，超过255的值取255，小于0的值取0</p>
</li>
<li><p>像素操作：这里没有使用ptr指针（因为操作不用考虑像素的具体x、y坐标，是单像素到单像素的映射），当然使用ptr也可以。Mat的data成员是数据头指针，程序通过指针<em>p与</em>q索引图片中的元素进行操作赋值</p>
</li>
</ol>
<h2>效果</h2>
<p><img src="../images/OpenCV基础篇之像素操作对比度调节/result.png" alt="result"></p>
<p>左边为元素图像，右边为alpha=1，Beta=50时的增强亮度后的图像。</p>
</font></font></body></html>